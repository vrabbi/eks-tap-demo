accelerator:
  displayName: Demo Web App
  description: A sample Spring Boot web application built with Tanzu supply-chain
  iconUrl: https://github.com/sample-accelerators/icons/raw/master/icon-boot.png
  tags:
  - java
  - spring
  - web
  - tanzu

  options:
  - name: gitUrl
    label: Git Repository URL
    display: true
    description: Git Repository URL of the application's source code
    inputType: text
    dataType: string
    defaultValue: "https://github.com/sample-accelerators/tanzu-java-web-app.git"
  - name: gitBranch
    label: Git Repository Branch
    display: true
    description: Git Repository Branch of the application's source code
    inputType: text
    dataType: string
    defaultValue: "main"
  - name: devMode
    label: Configure for Inner Loop Development
    description: Configures the needed settings for the VSCode Plugin integration
    display: true
    dataType: boolean
    inputType: checkbox
    defaultValue: false
  - name: ociCodeRepo
    label: OCI Repo URI for Source Code
    dependsOn:
      name: devMode
    description: OCI Repo URI for saving Code when using Live Update
    defaultValue: "your-registry.io/project/repo"
  - name: kubeContext
    label: Kubectl Context to develop against
    display: true
    description: Kubernetes Context for use when running the Live Update feature
    defaultValue: "eduk8s"
  - name: advSettings
    label: Configure Advanced Settings
    description: Fine tune settings for the workload deployment
    display: true
    inputType: checkbox
    dataType: boolean
    defaultValue: false
  - name: enableTesting
    label: Should unit test be run against your app
    dependsOn:
      name: advSettings
    description: If set to false then the workload will skip the tekton based testing pipelines
    inputType: select
    defaultValue: "true"
    choices:
      - text: "True"
        value: "true"
      - text: "False"
        value: "false"
  - name: enableScanning
    label: Should source and image scans be run against your app
    dependsOn:
      name: advSettings
    description: If set to false then the workload will skip the grype based source code and image scanning
    inputType: select
    defaultValue: "true"
    choices:
      - text: "True"
        value: "true"
      - text: "False"
        value: "false"
engine:
  merge:
  - include: [ "**/*" ]
    exclude: [ "tap/*.yaml", "Tiltfile", "README.md", "catalog/*.yaml" ]
  - include: [ "tap/*.yaml", "Tiltfile" ]
    chain:
    - type: ReplaceText
      substitutions:
      - text: https://github.com/sample-accelerators/tanzu-java-web-app
        with: "#gitUrl"
      - text: main
        with: "#gitBranch"
      - text: your-registry.io/project/repo
        with: "#ociCodeRepo"
      - text: tanzu-java-web-app
        with: "#artifactId"
      - text: "eduk8s"
        with: "#kubeContext"
  - include: [ "README.md" ]
    chain:
    - type: ReplaceText
      substitutions:
      - text: tanzu-java-web-app
        with: "#artifactId"
  - include: [ "catalog/*.yaml" ]
    chain:
    - type: ReplaceText
      substitutions:
      - text: tanzu-java-web-app
        with: "#artifactId"
    - type: RewritePath
      rewriteTo: "#filename"
  - include: [ "tap/*.yaml" ]
    chain: # Chain selected yaml files to YTT
      type: YTT
    
